From: Leo 'costela' Antunes <costela@debian.org>
Date: Sat, 12 Jun 2011 23:24:11 +0200
Subject: use system libminiupnpc

TODO: make this optional before forwarding upstream

Forwarded: no

Index: repo/configure.ac
===================================================================
--- repo.orig/configure.ac	2011-06-13 04:43:41.000000000 +0200
+++ repo/configure.ac	2011-06-13 04:46:21.000000000 +0200
@@ -205,6 +205,13 @@
 AC_SUBST(DHT_CFLAGS)
 AC_SUBST(DHT_LIBS)
 
+dnl ----------------------------------------------------------------------------
+dnl
+dnl  miniupnp
+
+MINIUPNPC_LIBS="-lminiupnpc"
+AC_SUBST(MINIUPNPC_LIBS)
+
 
 dnl ----------------------------------------------------------------------------
 dnl
@@ -498,7 +505,6 @@
                  libtransmission/Makefile
                  utils/Makefile
                  third-party/Makefile
-                 third-party/miniupnp/Makefile
                  third-party/libnatpmp/Makefile
                  third-party/libutp/Makefile
                  third-party/dht/Makefile
Index: repo/libtransmission/Makefile.am
===================================================================
--- repo.orig/libtransmission/Makefile.am	2011-06-13 04:43:42.000000000 +0200
+++ repo/libtransmission/Makefile.am	2011-06-13 04:46:21.000000000 +0200
@@ -139,7 +139,7 @@
 
 apps_ldadd = \
     ./libtransmission.a  \
-    $(top_builddir)/third-party/miniupnp/libminiupnp.a \
+    @MINIUPNPC_LIBS@ \
     $(top_builddir)/third-party/libnatpmp/libnatpmp.a \
     @INTLLIBS@ \
     @DHT_LIBS@ \
Index: repo/libtransmission/Makefile.in
===================================================================
--- repo.orig/libtransmission/Makefile.in	2011-06-13 04:43:42.000000000 +0200
+++ repo/libtransmission/Makefile.in	2011-06-13 04:50:19.000000000 +0200
@@ -94,7 +94,6 @@
 am_bencode_test_OBJECTS = bencode-test.$(OBJEXT)
 bencode_test_OBJECTS = $(am_bencode_test_OBJECTS)
 am__DEPENDENCIES_1 = ./libtransmission.a \
-	$(top_builddir)/third-party/miniupnp/libminiupnp.a \
 	$(top_builddir)/third-party/libnatpmp/libnatpmp.a
 bencode_test_DEPENDENCIES = $(am__DEPENDENCIES_1)
 AM_V_lt = $(am__v_lt_$(V))
@@ -513,7 +512,7 @@
 
 apps_ldadd = \
     ./libtransmission.a  \
-    $(top_builddir)/third-party/miniupnp/libminiupnp.a \
+    @MINIUPNPC_LIBS@ \
     $(top_builddir)/third-party/libnatpmp/libnatpmp.a \
     @INTLLIBS@ \
     @DHT_LIBS@ \
Index: repo/third-party/Makefile.am
===================================================================
--- repo.orig/third-party/Makefile.am	2011-06-13 04:43:41.000000000 +0200
+++ repo/third-party/Makefile.am	2011-06-13 04:46:21.000000000 +0200
@@ -5,7 +5,6 @@
 SUBDIRS = \
   dht \
   libnatpmp \
-  miniupnp \
   $(UTP_DIR)
 
 EXTRA_DIST = \
Index: repo/third-party/Makefile.in
===================================================================
--- repo.orig/third-party/Makefile.in	2011-06-13 04:43:41.000000000 +0200
+++ repo/third-party/Makefile.in	2011-06-13 04:46:21.000000000 +0200
@@ -69,7 +69,7 @@
 	distdir
 ETAGS = etags
 CTAGS = ctags
-DIST_SUBDIRS = dht libnatpmp miniupnp libutp
+DIST_SUBDIRS = dht libnatpmp libutp
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 am__relativize = \
   dir0=`pwd`; \
@@ -287,7 +287,6 @@
 SUBDIRS = \
   dht \
   libnatpmp \
-  miniupnp \
   $(UTP_DIR)
 
 EXTRA_DIST = \
Index: repo/utils/Makefile.am
===================================================================
--- repo.orig/utils/Makefile.am	2011-06-13 04:44:00.000000000 +0200
+++ repo/utils/Makefile.am	2011-06-13 04:46:21.000000000 +0200
@@ -26,7 +26,7 @@
 
 transmission_create_LDADD = \
     $(top_builddir)/libtransmission/libtransmission.a \
-    $(top_builddir)/third-party/miniupnp/libminiupnp.a \
+    @MINIUPNPC_LIBS@ \
     $(top_builddir)/third-party/libnatpmp/libnatpmp.a \
     @INTLLIBS@ \
     @DHT_LIBS@ \
Index: repo/utils/Makefile.in
===================================================================
--- repo.orig/utils/Makefile.in	2011-06-13 04:44:02.000000000 +0200
+++ repo/utils/Makefile.in	2011-06-13 04:49:11.000000000 +0200
@@ -57,7 +57,6 @@
 transmission_create_OBJECTS = $(am_transmission_create_OBJECTS)
 transmission_create_DEPENDENCIES =  \
 	$(top_builddir)/libtransmission/libtransmission.a \
-	$(top_builddir)/third-party/miniupnp/libminiupnp.a \
 	$(top_builddir)/third-party/libnatpmp/libnatpmp.a
 AM_V_lt = $(am__v_lt_$(V))
 am__v_lt_ = $(am__v_lt_$(AM_DEFAULT_VERBOSITY))
@@ -66,7 +65,6 @@
 transmission_edit_OBJECTS = $(am_transmission_edit_OBJECTS)
 am__DEPENDENCIES_1 =  \
 	$(top_builddir)/libtransmission/libtransmission.a \
-	$(top_builddir)/third-party/miniupnp/libminiupnp.a \
 	$(top_builddir)/third-party/libnatpmp/libnatpmp.a
 transmission_edit_DEPENDENCIES = $(am__DEPENDENCIES_1)
 am_transmission_show_OBJECTS = show.$(OBJEXT)
@@ -337,7 +335,7 @@
 
 transmission_create_LDADD = \
     $(top_builddir)/libtransmission/libtransmission.a \
-    $(top_builddir)/third-party/miniupnp/libminiupnp.a \
+    @MINIUPNPC_LIBS@ \
     $(top_builddir)/third-party/libnatpmp/libnatpmp.a \
     @INTLLIBS@ \
     @DHT_LIBS@ \
Index: repo/daemon/Makefile.am
===================================================================
--- repo.orig/daemon/Makefile.am	2011-06-13 04:47:01.000000000 +0200
+++ repo/daemon/Makefile.am	2011-06-13 04:47:26.000000000 +0200
@@ -20,7 +20,7 @@
 
 LDADD = \
     $(top_builddir)/libtransmission/libtransmission.a \
-    $(top_builddir)/third-party/miniupnp/libminiupnp.a \
+    @MINIUPNPC_LIBS@ \
     $(top_builddir)/third-party/libnatpmp/libnatpmp.a \
     @DHT_LIBS@ \
     @LIBUTP_LIBS@ \
Index: repo/daemon/Makefile.in
===================================================================
--- repo.orig/daemon/Makefile.in	2011-06-13 04:47:01.000000000 +0200
+++ repo/daemon/Makefile.in	2011-06-13 04:47:43.000000000 +0200
@@ -59,7 +59,6 @@
 transmission_daemon_LDADD = $(LDADD)
 transmission_daemon_DEPENDENCIES =  \
 	$(top_builddir)/libtransmission/libtransmission.a \
-	$(top_builddir)/third-party/miniupnp/libminiupnp.a \
 	$(top_builddir)/third-party/libnatpmp/libnatpmp.a
 AM_V_lt = $(am__v_lt_$(V))
 am__v_lt_ = $(am__v_lt_$(AM_DEFAULT_VERBOSITY))
@@ -69,7 +68,6 @@
 transmission_remote_LDADD = $(LDADD)
 transmission_remote_DEPENDENCIES =  \
 	$(top_builddir)/libtransmission/libtransmission.a \
-	$(top_builddir)/third-party/miniupnp/libminiupnp.a \
 	$(top_builddir)/third-party/libnatpmp/libnatpmp.a
 DEFAULT_INCLUDES = -I.@am__isrc@
 depcomp = $(SHELL) $(top_srcdir)/depcomp
@@ -333,7 +331,7 @@
 
 LDADD = \
     $(top_builddir)/libtransmission/libtransmission.a \
-    $(top_builddir)/third-party/miniupnp/libminiupnp.a \
+    @MINIUPNPC_LIBS@ \
     $(top_builddir)/third-party/libnatpmp/libnatpmp.a \
     @DHT_LIBS@ \
     @LIBUTP_LIBS@ \
Index: repo/cli/Makefile.in
===================================================================
--- repo.orig/cli/Makefile.in	2011-06-13 04:53:36.000000000 +0200
+++ repo/cli/Makefile.in	2011-06-13 04:54:50.000000000 +0200
@@ -56,8 +56,7 @@
 transmission_cli_OBJECTS = $(am_transmission_cli_OBJECTS)
 transmission_cli_DEPENDENCIES =  \
 	$(top_builddir)/libtransmission/libtransmission.a \
-	$(top_builddir)/third-party/libnatpmp/libnatpmp.a \
-	$(top_builddir)/third-party/miniupnp/libminiupnp.a
+	$(top_builddir)/third-party/libnatpmp/libnatpmp.a
 AM_V_lt = $(am__v_lt_$(V))
 am__v_lt_ = $(am__v_lt_$(AM_DEFAULT_VERBOSITY))
 am__v_lt_0 = --silent
@@ -319,7 +318,7 @@
 transmission_cli_LDADD = \
     $(top_builddir)/libtransmission/libtransmission.a \
     $(top_builddir)/third-party/libnatpmp/libnatpmp.a \
-    $(top_builddir)/third-party/miniupnp/libminiupnp.a \
+    @MINIUPNPC_LIBS@ \
     @DHT_LIBS@ \
     @LIBUTP_LIBS@ \
     @LIBEVENT_LIBS@ \
Index: repo/gtk/Makefile.am
===================================================================
--- repo.orig/gtk/Makefile.am	2011-06-13 04:53:39.000000000 +0200
+++ repo/gtk/Makefile.am	2011-06-13 04:56:13.000000000 +0200
@@ -93,7 +93,7 @@
 
 transmission_gtk_LDADD = \
     $(top_builddir)/libtransmission/libtransmission.a \
-    $(top_builddir)/third-party/miniupnp/libminiupnp.a \
+    @MINIUPNPC_LIBS@ \
     $(top_builddir)/third-party/libnatpmp/libnatpmp.a \
     @LIBCANBERRA_LIBS@ \
     @GCONF2_LIBS@ \
Index: repo/gtk/Makefile.in
===================================================================
--- repo.orig/gtk/Makefile.in	2011-06-13 04:53:39.000000000 +0200
+++ repo/gtk/Makefile.in	2011-06-13 04:57:01.000000000 +0200
@@ -74,7 +74,6 @@
 transmission_gtk_OBJECTS = $(am_transmission_gtk_OBJECTS)
 transmission_gtk_DEPENDENCIES =  \
 	$(top_builddir)/libtransmission/libtransmission.a \
-	$(top_builddir)/third-party/miniupnp/libminiupnp.a \
 	$(top_builddir)/third-party/libnatpmp/libnatpmp.a \
 	$(am__append_2)
 AM_V_lt = $(am__v_lt_$(V))
@@ -453,7 +452,7 @@
 dist_man_MANS = transmission-gtk.1
 transmission_gtk_LDADD =  \
 	$(top_builddir)/libtransmission/libtransmission.a \
-	$(top_builddir)/third-party/miniupnp/libminiupnp.a \
+	@MINIUPNPC_LIBS@ \
 	$(top_builddir)/third-party/libnatpmp/libnatpmp.a \
 	@LIBCANBERRA_LIBS@ @GCONF2_LIBS@ @DHT_LIBS@ @LIBUTP_LIBS@ \
 	@GTK_LIBS@ @GIO_LIBS@ @LIBAPPINDICATOR_LIBS@ @LIBNOTIFY_LIBS@ \
Index: repo/qt/qtr.pro
===================================================================
--- repo.orig/qt/qtr.pro	2011-06-13 05:19:04.000000000 +0200
+++ repo/qt/qtr.pro	2011-06-13 05:19:23.000000000 +0200
@@ -21,9 +21,8 @@
 LIBS += $${TRANSMISSION_TOP}/libtransmission/libtransmission.a
 LIBS += $${TRANSMISSION_TOP}/third-party/libutp/libutp.a
 LIBS += $${TRANSMISSION_TOP}/third-party/dht/libdht.a
-LIBS += $${TRANSMISSION_TOP}/third-party/miniupnp/libminiupnp.a
 LIBS += $${TRANSMISSION_TOP}/third-party/libnatpmp/libnatpmp.a
-unix: LIBS += -L$${EVENT_TOP}/lib -lz -lrt
+unix: LIBS += -L$${EVENT_TOP}/lib -lminiupnpc -lz -lrt
 win32:DEFINES += QT_DBUS
 win32:LIBS += -levent-2.0 -lws2_32 -lintl
 win32:LIBS += -lidn -liconv -lwldap32 -liphlpapi
Index: repo/cli/Makefile.am
===================================================================
--- repo.orig/cli/Makefile.am
+++ repo/cli/Makefile.am
@@ -19,7 +19,7 @@ transmission_cli_SOURCES = cli.c
 transmission_cli_LDADD = \
     $(top_builddir)/libtransmission/libtransmission.a \
     $(top_builddir)/third-party/libnatpmp/libnatpmp.a \
-    $(top_builddir)/third-party/miniupnp/libminiupnp.a \
+    @MINIUPNPC_LIBS@ \
     @DHT_LIBS@ \
     @LIBUTP_LIBS@ \
     @LIBEVENT_LIBS@ \
Index: repo/libtransmission/upnp.c
===================================================================
--- repo.orig/libtransmission/upnp.c	2011-06-23 00:56:27.000000000 +0200
+++ repo/libtransmission/upnp.c	2011-06-23 00:56:45.000000000 +0200
@@ -13,8 +13,8 @@
 #include <assert.h>
 #include <errno.h>
 
-#include <miniupnp/miniupnpc.h>
-#include <miniupnp/upnpcommands.h>
+#include <miniupnpc/miniupnpc.h>
+#include <miniupnpc/upnpcommands.h>
 
 #include "transmission.h"
 #include "port-forwarding.h"
